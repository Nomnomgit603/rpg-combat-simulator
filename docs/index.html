
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RPG Combat Simulator</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #0f0;
      padding: 20px;
    }
    #log {
      white-space: pre-wrap;
      background: #000;
      padding: 10px;
      border: 1px solid #0f0;
      height: 400px;
      overflow-y: scroll;
    }
    button, select {
      margin-top: 10px;
      padding: 10px;
      background: #222;
      color: #0f0;
      border: 1px solid #0f0;
      cursor: pointer;
    }
  </style>
</head>
<body>
<h2>RPG Combat Simulator (Select Characters)</h2>
<label for="charA">Choose Character A:</label>
<select id="charA">
  <option value="Berserker1">Berserker1</option>
  <option value="Sniper1">Sniper1</option>
</select>
<br>
<label for="charB">Choose Character B:</label>
<select id="charB">
  <option value="Sniper1">Sniper1</option>
  <option value="Berserker1">Berserker1</option>
</select>
<br>
<button onclick="runCombat()">Run Combat</button>
<div id="log"></div>

<script>
class Character {
  constructor(name, hp, ap, pd, dr, attacks) {
    this.name = name;
    this.maxHp = hp;
    this.hp = hp;
    this.ap = ap;
    this.pd = pd;
    this.dr = dr;
    this.attacks = attacks;
    this.wasAliveLastTurn = true;
  }

  isAlive() {
    return this.hp > 0;
  }
}

function rollDice(sides, count = 1) {
  let total = 0;
  for (let i = 0; i < count; i++) {
    total += Math.floor(Math.random() * sides) + 1;
  }
  return total;
}

function log(msg) {
  const logBox = document.getElementById('log');
  logBox.innerText += msg + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

function createCharacter(name) {
  if (name === "Berserker1") {
    return new Character("Berserker1", 22, 4, 30, 6, [
      { name: "Heavy Attack", cost: 2, hitMod: 3, dmgDice: 12, diceCount: 2 }
    ]);
  }
  if (name === "Sniper1") {
    return new Character("Sniper1", 23, 4, 30, 2, [
      { name: "Aimed Attack", cost: 3, hitMod: 19, dmgDice: 10, diceCount: 1 },
      { name: "Normal Attack", cost: 2, hitMod: 9, dmgDice: 10, diceCount: 1 },
      { name: "Quick Attack", cost: 1, hitMod: -1, dmgDice: 10, diceCount: 1 }
    ]);
  }
  return null;
}

function runCombat() {
  document.getElementById('log').innerText = '';
  const nameA = document.getElementById("charA").value;
  const nameB = document.getElementById("charB").value;

  const a = createCharacter(nameA);
  const b = createCharacter(nameB);

  let round = 1;
  let combatOver = false;

  while (!combatOver) {
    log(`--- Round ${round} ---`);
    a.ap = 4;
    b.ap = 4;

    a.wasAliveLastTurn = a.isAlive();
    b.wasAliveLastTurn = b.isAlive();

    // Character A turn
    if (a.wasAliveLastTurn) {
      for (let atk of a.attacks) {
        while (a.ap >= atk.cost && b.isAlive()) {
          a.ap -= atk.cost;
          const hitRoll = rollDice(50) + atk.hitMod;
          const overhitDice = Math.floor((hitRoll - b.pd) / 10);
          log(`${a.name} uses ${atk.name}: ${hitRoll} vs PD ${b.pd} (Overhit Dice: ${overhitDice})`);
          if (hitRoll >= b.pd) {
            const dmg = rollDice(atk.dmgDice, atk.diceCount + overhitDice);
            const finalDmg = Math.max(dmg - b.dr, 0);
            b.hp -= finalDmg;
            log(`${a.name} hits for ${dmg} - ${b.dr} DR = ${finalDmg} damage! (${Math.max(b.hp, 0)} HP left)`);
          } else {
            log(`${a.name} misses!`);
          }
        }
      }
    }

    // Character B turn
    if (b.wasAliveLastTurn) {
      for (let atk of b.attacks) {
        while (b.ap >= atk.cost && a.isAlive()) {
          b.ap -= atk.cost;
          const hitRoll = rollDice(50) + atk.hitMod;
          const overhitDice = Math.floor((hitRoll - a.pd) / 10);
          log(`${b.name} uses ${atk.name}: ${hitRoll} vs PD ${a.pd} (Overhit Dice: ${overhitDice})`);
          if (hitRoll >= a.pd) {
            const dmg = rollDice(atk.dmgDice, atk.diceCount + overhitDice);
            const finalDmg = Math.max(dmg - a.dr, 0);
            a.hp -= finalDmg;
            log(`${b.name} hits for ${dmg} - ${a.dr} DR = ${finalDmg} damage! (${Math.max(a.hp, 0)} HP left)`);
          } else {
            log(`${b.name} misses!`);
          }
        }
      }
    }

    round++;

    if (!a.isAlive() && !b.isAlive()) {
      log(`\nCombat ends in a tie. Both combatants have fallen.`);
      combatOver = true;
    } else if (!a.isAlive()) {
      log(`\nCombat ends. Winner: ${b.name}`);
      log(`Remaining HP: ${Math.max(b.hp, 0)} HP`);
      combatOver = true;
    } else if (!b.isAlive()) {
      log(`\nCombat ends. Winner: ${a.name}`);
      log(`Remaining HP: ${Math.max(a.hp, 0)} HP`);
      combatOver = true;
    }
  }
}
</script>
</body>
</html>
